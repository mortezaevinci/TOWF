<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">qout</span> <span class="var type1" id="S3T2U4">isconverged</span>] = ikine_M26_cc(<span class="var type1" id="S4T4U7">TT</span>, <span class="var type1" id="S5T3U8">L</span>, <span class="var type1" id="S6T1U9">q0</span>) <span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,2">  2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,3">  3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,4">  4</a></span><span class="line">    <span class="mxinfo" id="T2:U6"><span class="var type1" id="S7T2U12">method</span>=<span class="mxinfo" id="T2:U8">1</span></span>; <span class="comment">%0 for ordinary jacobean, 1 for DLS</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5">  5</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,6">  6</a></span><span class="line">	<span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7">  7</a></span><span class="line">	<span class="comment">%  solution control parameters</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8">  8</a></span><span class="line">	<span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9">  9</a></span><span class="line">	<span class="mxinfo" id="T2:U9"><span class="var type1" id="S8T2U16">ilimit</span> = <span class="mxinfo" id="T2:U11">250</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,10"> 10</a></span><span class="line">	<span class="mxinfo" id="T2:U12"><span class="var type1" id="S9T2U20">stol</span> = <span class="mxinfo" id="T2:U14">1e-2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11"> 11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,12"> 12</a></span><span class="line">	<span class="mxinfo" id="T2:U15"><span class="var type1" id="S3T2U24">isconverged</span>=<span class="mxinfo" id="T2:U17">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13"> 13</a></span><span class="line"><span class="mxinfo" id="T1:U18"><span class="var type1" id="S10T1U28">dq</span>=<span class="mxinfo" id="T1:U20">zeros(6,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14"> 14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,15"> 15</a></span><span class="line">	<span class="keyword">if</span> nargin == 2,</span></span>
<span class="srcline"><span class="lineno"><a href="1,16"> 16</a></span><span class="line">		<span class="var type2" id="S13T0U41">q</span> = zeros(6, 1);</span></span>
<span class="srcline"><span class="lineno"><a href="1,17"> 17</a></span><span class="line">	<span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18"> 18</a></span><span class="line">		<span class="mxinfo" id="T1:U21"><span class="var type1" id="S13T1U49">q</span> = <span class="mxinfo" id="T1:U23"><span class="var type1" id="S6T1U51">q0</span>(:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19"> 19</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20"> 20</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,21"> 21</a></span><span class="line">    <span class="mxinfo" id="T2:U25"><span class="var type1" id="S14T2U55">n</span> = <span class="mxinfo" id="T2:U27">numel(<span class="var type1" id="S13T1U58">q</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,22"> 22</a></span><span class="line">   </span></span>
<span class="srcline"><span class="lineno"><a href="1,23"> 23</a></span><span class="line">		<span class="keyword">if</span> <span class="var type1" id="S14T2U62">n</span> == 6</span></span>
<span class="srcline"><span class="lineno"><a href="1,24"> 24</a></span><span class="line">		</span></span>
<span class="srcline"><span class="lineno"><a href="1,25"> 25</a></span><span class="line">		</span></span>
<span class="srcline"><span class="lineno"><a href="1,26"> 26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,27"> 27</a></span><span class="line">	<span class="mxinfo" id="T2:U30"><span class="var type1" id="S16T2U66">tcount</span> = <span class="mxinfo" id="T2:U32">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28"> 28</a></span><span class="line"><span class="comment">% 	if ishomog(tr),		% single xform case</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29"> 29</a></span><span class="line">		<span class="mxinfo" id="T2:U33"><span class="var type1" id="S17T2U70">nm</span> = <span class="mxinfo" id="T2:U35">5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30"> 30</a></span><span class="line">		<span class="mxinfo" id="T2:U36"><span class="var type1" id="S18T2U74">count</span> = <span class="mxinfo" id="T2:U38">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31"> 31</a></span><span class="line">		<span class="keyword">while</span> <span class="mxinfo" id="T10:U39"><span class="var type1" id="S17T2U78">nm</span> &gt; <span class="var type1" id="S9T2U79">stol</span></span>,</span></span>
<span class="srcline"><span class="lineno"><a href="1,32"> 32</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,33"> 33</a></span><span class="line">			<span class="mxinfo" id="T1:U42"><span class="var type1" id="S19T1U82">dx</span> = <span class="mxinfo" id="T1:U44"><span class="mxinfo" id="T1:U45">-<span class="mxinfo" id="T1:U46"><span class="fcn" id="F20N3:B86">T2cartesian_real</span>(<span class="mxinfo" id="T4:U47"><span class="fcn" id="F8N4:B88">fkine_M26</span>(<span class="var type1" id="S5T3U89">L</span>, <span class="mxinfo" id="T3:U49"><span class="var type1" id="S13T1U91">q</span>'</span>)</span>)</span></span>+<span class="mxinfo" id="T1:U51"><span class="fcn" id="F20N3:B93">T2cartesian_real</span>(<span class="var type1" id="S4T4U94">TT</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34"> 34</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,35"> 35</a></span><span class="line">            <span class="keyword">switch</span> <span class="var type1" id="S7T2U96">method</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36"> 36</a></span><span class="line">                <span class="keyword">case</span> 0</span></span>
<span class="srcline"><span class="lineno"><a href="1,37"> 37</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,38"> 38</a></span><span class="line">		             	<span class="var type2" id="S10T0U101">dq</span> = rem(pinv( jacob_M26(<span class="var type2" id="S5T0U109">L</span>, <span class="var type2" id="S13T0U110">q</span>) ) * <span class="var type2" id="S19T0U111">dx</span>,2*pi);</span></span>
<span class="srcline"><span class="lineno"><a href="1,39"> 39</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,40"> 40</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,41"> 41</a></span><span class="line">                <span class="keyword">case</span> 1</span></span>
<span class="srcline"><span class="lineno"><a href="1,42"> 42</a></span><span class="line">                  </span></span>
<span class="srcline"><span class="lineno"><a href="1,43"> 43</a></span><span class="line">                        <span class="mxinfo" id="T12:U54"><span class="var type1" id="S26T12U120">J</span>=<span class="mxinfo" id="T12:U56"><span class="fcn" id="F35N6:B122">jacob_M26</span>(<span class="var type1" id="S5T3U123">L</span>, <span class="var type1" id="S13T1U124">q</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44"> 44</a></span><span class="line">                        <span class="mxinfo" id="T2:U59"><span class="var type1" id="S27T2U127">lambda</span>=<span class="mxinfo" id="T2:U61">.005</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,45"> 45</a></span><span class="line">                        </span></span>
<span class="srcline"><span class="lineno"><a href="1,46"> 46</a></span><span class="line">                         <span class="mxinfo" id="T12:U62"><span class="var type1" id="S28T12U131">qq</span>=<span class="mxinfo" id="T12:U64"><span class="mxinfo" id="T12:U65"><span class="var type1" id="S26T12U134">J</span>*<span class="mxinfo" id="T12:U67"><span class="var type1" id="S26T12U136">J</span>'</span></span>+<span class="mxinfo" id="T12:U69"><span class="var type1" id="S27T2U138">lambda</span>*eye(6)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,47"> 47</a></span><span class="line">                        <span class="keyword">if</span> <span class="mxinfo" id="T10:U71"><span class="mxinfo" id="T2:U72">det(<span class="var type1" id="S28T12U147">qq</span>)</span>~=<span class="mxinfo" id="T2:U74">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,48"> 48</a></span><span class="line">                        <span class="mxinfo" id="T1:U75"><span class="var type1" id="S10T1U151">dq</span>=<span class="mxinfo" id="T1:U77"><span class="mxinfo" id="T1:U78">rem(<span class="mxinfo" id="T1:U79"><span class="mxinfo" id="T12:U80"><span class="mxinfo" id="T12:U81"><span class="var type1" id="S26T12U158">J</span>'</span>*<span class="mxinfo" id="T12:U83">(<span class="var type1" id="S28T12U161">qq</span>)^-1</span></span>*<span class="var type1" id="S19T1U164">dx</span></span>,<span class="mxinfo" id="T2:U86">2*pi</span>)</span>/<span class="mxinfo" id="T2:U87">10</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,49"> 49</a></span><span class="line">                        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,50"> 50</a></span><span class="line">                        <span class="mxinfo" id="T1:U88"><span class="var type1" id="S10T1U173">dq</span>=<span class="var type1" id="S13T1U174">q</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,51"> 51</a></span><span class="line">                        <span class="mxinfo" id="T2:U91"><span class="var type1" id="S18T2U177">count</span>=<span class="mxinfo" id="T2:U93"><span class="var type1" id="S18T2U179">count</span>+<span class="mxinfo" id="T2:U95">500</span></span></span>; <span class="comment">%finish</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52"> 52</a></span><span class="line">                        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,53"> 53</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,54"> 54</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55"> 55</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,56"> 56</a></span><span class="line">               </span></span>
<span class="srcline"><span class="lineno"><a href="1,57"> 57</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,58"> 58</a></span><span class="line">			<span class="mxinfo" id="T1:U96"><span class="var type1" id="S13T1U183">q</span> = <span class="mxinfo" id="T1:U98">rem(<span class="mxinfo" id="T1:U99"><span class="var type1" id="S13T1U187">q</span> + <span class="var type1" id="S10T1U188">dq</span></span>,<span class="mxinfo" id="T2:U102">2*pi</span>)</span></span>;<span class="comment">%+rand(6,1).*.0001;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,59"> 59</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S31T2U195">ii</span>=<span class="mxinfo" id="T2:U104">1</span>:<span class="mxinfo" id="T2:U105">numel(<span class="var type1" id="S13T1U200">q</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,60"> 60</a></span><span class="line">               <span class="keyword">if</span> <span class="mxinfo" id="T10:U107"><span class="mxinfo" id="T2:U108"><span class="var type1" id="S13T1U205">q</span>(<span class="var type1" id="S31T2U206">ii</span>)</span>&gt;<span class="mxinfo" id="T2:U111">pi</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,61"> 61</a></span><span class="line">                   <span class="mxinfo" id="T2:U112"><span class="mxinfo" id="T2:U113"><span class="var type1" id="S13T1U212">q</span>(<span class="var type1" id="S31T2U213">ii</span>)</span>=<span class="mxinfo" id="T2:U116"><span class="mxinfo" id="T2:U117"><span class="var type1" id="S13T1U216">q</span>(<span class="var type1" id="S31T2U217">ii</span>)</span>-<span class="mxinfo" id="T2:U120"><span class="mxinfo" id="T2:U121">2</span>*<span class="mxinfo" id="T2:U122">pi</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,62"> 62</a></span><span class="line">               <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,63"> 63</a></span><span class="line">               <span class="keyword">if</span> <span class="mxinfo" id="T10:U123"><span class="mxinfo" id="T2:U124"><span class="var type1" id="S13T1U226">q</span>(<span class="var type1" id="S31T2U227">ii</span>)</span>&lt;<span class="mxinfo" id="T2:U127">-<span class="mxinfo" id="T2:U128">pi</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64"> 64</a></span><span class="line">                   <span class="mxinfo" id="T2:U129"><span class="mxinfo" id="T2:U130"><span class="var type1" id="S13T1U234">q</span>(<span class="var type1" id="S31T2U235">ii</span>)</span>=<span class="mxinfo" id="T2:U133"><span class="mxinfo" id="T2:U134"><span class="var type1" id="S13T1U238">q</span>(<span class="var type1" id="S31T2U239">ii</span>)</span>+<span class="mxinfo" id="T2:U137"><span class="mxinfo" id="T2:U138">2</span>*<span class="mxinfo" id="T2:U139">pi</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,65"> 65</a></span><span class="line">               <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,66"> 66</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67"> 67</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,68"> 68</a></span><span class="line">            <span class="comment">%a non-mathematical enforcement of solution constraints</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,69"> 69</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo" id="T10:U140"><span class="mxinfo" id="T2:U141"><span class="var type1" id="S13T1U248">q</span>(<span class="mxinfo" id="T2:U143">4</span>)</span>&gt;<span class="mxinfo" id="T2:U144">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,70"> 70</a></span><span class="line"><span class="comment">%                 %possibility1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71"> 71</a></span><span class="line"><span class="comment">%                q(1)=-q(1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,72"> 72</a></span><span class="line"><span class="comment">%                q(3)=-q(3);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,73"> 73</a></span><span class="line"><span class="comment">%                q(5)=-q(5);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,74"> 74</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,75"> 75</a></span><span class="line"><span class="mxinfo" id="T1:U145"><span class="var type1" id="S13T1U253">q</span>=<span class="mxinfo" id="T1:U147"><span class="fcn" id="F175N7:B255">kine_sol2</span>(<span class="var type1" id="S13T1U256">q</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,76"> 76</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,77"> 77</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,78"> 78</a></span><span class="line">            <span class="mxinfo" id="T1:U149"><span class="var type1" id="S13T1U259">q</span>=<span class="mxinfo" id="T1:U151"><span class="fcn" id="F176N8:B261">myjointlimits</span>(<span class="var type1" id="S13T1U262">q</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,79"> 79</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,80"> 80</a></span><span class="line"><span class="comment">%             %specific to M26</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,81"> 81</a></span><span class="line"><span class="comment">%             if q(3)&lt;0</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,82"> 82</a></span><span class="line"><span class="comment">%                q(3)=q(3)+pi;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,83"> 83</a></span><span class="line"><span class="comment">%                q(4)=-q(4);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,84"> 84</a></span><span class="line"><span class="comment">%                if q(5)&lt;0</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,85"> 85</a></span><span class="line"><span class="comment">%                q(5)=q(5)+pi;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,86"> 86</a></span><span class="line"><span class="comment">%                else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,87"> 87</a></span><span class="line"><span class="comment">%                    q(5)=q(5)-pi;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,88"> 88</a></span><span class="line"><span class="comment">%                end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,89"> 89</a></span><span class="line"><span class="comment">%                 </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,90"> 90</a></span><span class="line"><span class="comment">%             end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,91"> 91</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,92"> 92</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,93"> 93</a></span><span class="line">			<span class="mxinfo" id="T2:U153"><span class="var type1" id="S17T2U265">nm</span> = <span class="mxinfo" id="T2:U155">norm(<span class="var type1" id="S10T1U268">dq</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,94"> 94</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo" id="T10:U157">isnan(<span class="var type1" id="S17T2U273">nm</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,95"> 95</a></span><span class="line">                <span class="mxinfo" id="T2:U159"><span class="var type1" id="S17T2U276">nm</span>=<span class="mxinfo" id="T2:U161">5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,96"> 96</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,97"> 97</a></span><span class="line">			<span class="mxinfo" id="T2:U162"><span class="var type1" id="S18T2U280">count</span> = <span class="mxinfo" id="T2:U164"><span class="var type1" id="S18T2U282">count</span>+<span class="mxinfo" id="T2:U166">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,98"> 98</a></span><span class="line">			<span class="keyword">if</span> <span class="mxinfo" id="T10:U167"><span class="var type1" id="S18T2U287">count</span> &gt; <span class="var type1" id="S8T2U288">ilimit</span></span>,</span></span>
<span class="srcline"><span class="lineno"><a href="1,99"> 99</a></span><span class="line">				</span></span>
<span class="srcline"><span class="lineno"><a href="1,100">100</a></span><span class="line">                <span class="mxinfo" id="T2:U170"><span class="var type1" id="S3T2U291">isconverged</span>=<span class="mxinfo" id="T2:U172">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,101">101</a></span><span class="line">                <span class="keyword">break</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,102">102</a></span><span class="line">			<span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,103">103</a></span><span class="line">		<span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,104">104</a></span><span class="line">		<span class="mxinfo" id="T1:U173"><span class="var type1" id="S2T1U296">qout</span> = <span class="var type1" id="S13T1U297">q</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,105">105</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,106">106</a></span><span class="line">            	</span></span>
<span class="srcline"><span class="lineno"><a href="1,107">107</a></span><span class="line">                <span class="var type2" id="S3T0U301">isconverged</span>=0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,108">108</a></span><span class="line">        <span class="keyword"><span class="keyword">end</span></span></span></span>
</pre>
